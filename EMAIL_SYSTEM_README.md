# üìß Email System Documentation

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email —Å WYSIWYG-—Ä–µ–¥–∞–∫—Ç–æ—Ä–æ–º, —à–∞–±–ª–æ–Ω–∞–º–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã "–®–∫–æ–ª–∞ –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ –°—É—Ö–∞—Ä–µ–≤–æ–π –ê–Ω–∞—Å—Ç–∞—Å–∏–∏".

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ Email

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç**: `/src/app/components/admin/EmailComposerModal.tsx`

–§—É–Ω–∫—Ü–∏–∏:
- ‚úÖ WYSIWYG-—Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ React Quill
- ‚úÖ –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º (4 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ (–∞–≤—Ç–æ–∑–∞–º–µ–Ω–∞ {{name}})
- ‚úÖ –ü–æ–ª—è "–¢–µ–º–∞" –∏ "–¢–µ–∫—Å—Ç –ø–∏—Å—å–º–∞"
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, —Å—Å—ã–ª–∫–∏, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

### 2. Message Queue —Å–∏—Å—Ç–µ–º–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ email:
```typescript
// 1. Email —Å—Ç–∞–≤–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å (status: 'queued')
const emailLog: EmailLogEntry = {
  id: `email-${Date.now()}`,
  userId,
  to: recipientEmail,
  subject,
  body,
  sentAt: new Date().toISOString(),
  status: 'queued', // –°–Ω–∞—á–∞–ª–∞ –≤ –æ—á–µ—Ä–µ–¥—å
};

// 2. –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã —Å—Ç–∞—Ç—É—Å –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ 'delivered'
setTimeout(() => {
  emailLog.status = 'delivered';
}, 2000);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üöÄ –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI –∞–¥–º–∏–Ω–∫–∏
- üìä –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏
- üîÑ –ú–æ–∂–Ω–æ –ª–µ–≥–∫–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º Message Queue (RabbitMQ, Redis Queue)

### 3. Email Logs (–ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí "–ò—Å—Ç–æ—Ä–∏—è Email"

–ö–∞–∂–¥–æ–µ –ø–∏—Å—å–º–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
```typescript
interface EmailLogEntry {
  id: string;
  userId: string;
  to: string;
  subject: string;
  body: string;
  sentAt: string;
  status: 'queued' | 'sent' | 'delivered' | 'failed';
  error?: string;
}
```

**–°—Ç–∞—Ç—É—Å—ã**:
- üü° `queued` - –í –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É
- üîµ `sent` - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- üü¢ `delivered` - –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- üî¥ `failed` - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

### 4. –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã

#### –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø–∏—Å—å–º–æ
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: `welcome`
- –°–æ–¥–µ—Ä–∂–∏—Ç: –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏, –∫–æ–Ω—Ç–∞–∫—Ç—ã

#### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö —É—Ä–æ–∫–∞—Ö
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: `reminder`
- –°–æ–¥–µ—Ä–∂–∏—Ç: –ú–æ—Ç–∏–≤–∞—Ü–∏—è –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é –æ–±—É—á–µ–Ω–∏—è

#### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–± –∞–ø–≥—Ä–µ–π–¥–µ —Ç–∞—Ä–∏—Ñ–∞
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: `marketing`
- –°–æ–¥–µ—Ä–∂–∏—Ç: –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ–≤—ã—à–µ–Ω–∏—è —Ç–∞—Ä–∏—Ñ–∞

#### –û—Ç–≤–µ—Ç –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
- –ö–∞—Ç–µ–≥–æ—Ä–∏—è: `support`
- –°–æ–¥–µ—Ä–∂–∏—Ç: –®–∞–±–ª–æ–Ω –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –û—Ç–ø—Ä–∞–≤–∫–∞ email –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ù–∞–∂–º–∏—Ç–µ "–î–µ–π—Å—Ç–≤–∏—è" ‚Üí "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –Ω–∞ –ø–æ—á—Ç—É"
3. –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –ø–∏—Å—å–º–æ —Å –Ω—É–ª—è
4. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

### –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ email

–í –∫–∞—Ä—Ç–æ—á–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –¥–æ —Å–µ–∫—Ü–∏–∏ "–ò—Å—Ç–æ—Ä–∏—è Email". –¢–∞–º –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–∏—Å—å–º–∞ —Å:
- –¢–µ–º–æ–π –ø–∏—Å—å–º–∞
- –°—Ç–∞—Ç—É—Å–æ–º –¥–æ—Å—Ç–∞–≤–∫–∏
- –í—Ä–µ–º–µ–Ω–µ–º –æ—Ç–ø—Ä–∞–≤–∫–∏
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —Ç–µ–∫—Å—Ç–∞

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º backend –∑–∞–º–µ–Ω–∏—Ç–µ mock-—Ñ—É–Ω–∫—Ü–∏—é –≤ `EmailComposerModal.tsx`:

```typescript
const handleSend = async () => {
  setIsSending(true);

  try {
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ backend API
    const response = await fetch('/api/emails/send', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId,
        to: recipientEmail,
        subject,
        body,
      }),
    });

    const data = await response.json();
    
    if (onEmailSent) {
      onEmailSent(data.emailLog);
    }

    toast.success('Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
  } catch (error) {
    toast.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email');
  } finally {
    setIsSending(false);
  }
};
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ EmailLogs (PostgreSQL)

```sql
CREATE TABLE email_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  to_email VARCHAR(255) NOT NULL,
  subject TEXT NOT NULL,
  body TEXT NOT NULL,
  sent_at TIMESTAMP DEFAULT NOW(),
  status VARCHAR(20) DEFAULT 'queued',
  error TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_email_logs_user_id ON email_logs(user_id);
CREATE INDEX idx_email_logs_status ON email_logs(status);
CREATE INDEX idx_email_logs_sent_at ON email_logs(sent_at DESC);
```

## –°—Ç–∏–ª–∏

–ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `/src/styles/quill-custom.css`:
- –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞ —Å —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ç—É–ª–±–∞—Ä–∞
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Å–ø–∏—Å–∫–∏, —Ü–∏—Ç–∞—Ç—ã)

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **React Quill** - WYSIWYG —Ä–µ–¥–∞–∫—Ç–æ—Ä
- **Motion/React** - –ê–Ω–∏–º–∞—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- **Tailwind CSS** - –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **TypeScript** - –¢–∏–ø–∏–∑–∞—Ü–∏—è
- **Sonner** - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## TODO / –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –ü—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫ –ø–∏—Å—å–º—É
- [ ] –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö ({{variable}})
- [ ] –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∏—Å–µ–º
- [ ] –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏–π –∏ –∫–ª–∏–∫–æ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ESP (SendGrid, Mailgun, etc.)

## –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ª–æ–≥–∏

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ email –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—Å—è:
```
üìß Email –¥–æ–±–∞–≤–ª–µ–Ω –≤ Message Queue: { id, userId, to, subject, body, sentAt, status }
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–¥–∫–µ –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π.
